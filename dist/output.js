document.write('<!doctype html><meta charset=UTF-8><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><title>Market Street Tycoon</title><link rel="shortcut icon" type=image/x-icon><style>#c2d{height:100vh;aspect-ratio:160/144;position:absolute;image-rendering:pixelated;background-color:#000}body,html{margin:0;background-color:#111;display:flex;justify-content:center;align-items:center;height:100%;user-select:none}@media (max-width:900px){body{background:#f7cebd}#gamepad{position:fixed;top:0;left:0;height:100vh;width:100vw}b{position:absolute;display:inline-flex;border:2px solid;border-radius:7vmax;height:7vmax;width:7vmax;font-size:3vmax;color:#3f2e28;justify-content:center;align-items:center;font-family:monospace;transition:50ms ease-in-out}b:active{color:#f7cebd;transform:scale(1.2)}#down,#up{left:8vmax;bottom:20vmax}#down{bottom:7vmax}#left,#right{left:1.5vmax;bottom:13.5vmax}#right{left:14.5vmax}#ok{right:8vmax;bottom:13.5vmax}}@media (orientation:portrait){body{align-items:flex-start;padding-top:20vh}#gamepad{top:-10vw;left:4vw}#c2d{height:auto;width:100vw}#ok{right:7vmax}}</style><div id=gamepad><b id=up>▲</b><b id=down>▼</b><b id=left>◀</b><b id=right>▶</b><b id=ok>OK</b></div><canvas id=c2d></canvas><canvas id=font height=20 hidden style="border:1px solid" width=250></canvas>');let k,l,n=[],p={E:-5,F:-4,G:-2,a:0,b:2,c:3,d:5,e:7,"-":-999};"GddGddGccGccGeeGeeFddFddEaaGddGddaddGddaddGdbG--".split("").forEach(a=>{n.push(-p[a])});
let q=!0,r=0,t=0,u=(a=!1)=>{if(q){if(t+.25*r<k.currentTime){var b=n[r],c=t+.25*r;let e=k.createOscillator();var d=k.createGain(),f=k.createBiquadFilter();f.type="bandpass";f.frequency.setValueAtTime(800,c);e.type="square";e.connect(d);d.connect(f).connect(k.destination);d.gain.setValueAtTime(.01,c);f=.8;d.gain.linearRampToValueAtTime(.3,c+.25*f);d.gain.setValueAtTime(.3,c+.25*f);d.gain.setValueAtTime(.3,c+.25*(1.5-f));d.gain.linearRampToValueAtTime(.01,c+.375);e.frequency.setValueAtTime(440/1.06**
b,c);f=l=k.createBufferSource();b=.25*k.sampleRate;d=k.createBuffer(1,b,k.sampleRate);let g=d.getChannelData(0);for(let h=0;h<b;h++)g[h]=2*Math.random()-1;f.buffer=d;b=k.createBiquadFilter();b.type="bandpass";b.frequency.setValueAtTime(500,c);d=k.createGain();d.gain.setValueAtTime(.01,c);f=.47;d.gain.exponentialRampToValueAtTime(.3,c+.25*f);d.gain.setValueAtTime(.3,c+.25*(.9-f));d.gain.exponentialRampToValueAtTime(.01,c+.25);l.connect(b).connect(d).connect(k.destination);l.start();e.start(c);e.stop(c+
.375);r++;if(r==n.length){if(!a)return;t=k.currentTime+.25;r=0}}setTimeout(u,.25)}},v=["apples","bread","oil"],w="Catarina Leonor Bento Marcos Apar\u00edcia Isabel Manuel Gra\u00e7a Teresa Vicente Jacinta Jo\u00e3o Diogo Sim\u00e3o Luciana Gil".split(" "),x=()=>{let a=w.pop();w.unshift(a);return a};
class y{constructor(){this.o=[];this.j={};this.m={};this.J={bread:1,apples:.6,oil:.4};this.P={bread:3,apples:4,oil:8};this.S={bread:1,apples:.4,oil:0};this.v=1;this.history=[];this.u=16;var a={I:"bread",N:x(),m:0,j:8};this.o.push(a);a={I:"apples",N:x(),m:0,j:8};this.o.push(a);a={I:"oil",N:x(),m:0,j:4};this.o.push(a)}save(a,b){this.history[this.v]={J:a,M:b};localStorage.setItem("history",JSON.stringify({history:this.history,o:this.o,u:this.u,j:this.j}))}}
function z(a,b){var c=[];a.g.R?.();a.g=b;a.g.L?.(...c)}class A{constructor(a,...b){this.g=a;this.g.L?.(...b)}}let B,C;function D(a,b,c){b=b.targetTouches[0]?.target?.id;c?b&&(a.l=b):a.l=""}function E(a,b){var c=F;c.D&&!c.g.D&&0<a.selection&&a.selection--;c.A&&!c.g.A&&a.selection<b&&a.selection++}
class G{constructor(){this.K=this.s=this.C=this.B=this.A=this.D=!1;this.h=new Map;this.l="";this.g={D:this.D,A:this.A,B:this.B,C:this.C,s:this.s,K:this.K};document.addEventListener("keydown",a=>{this.h.set(a.code,!0)});document.addEventListener("keyup",a=>{this.h.set(a.code,!1)});this.i=new DOMPoint;document.addEventListener("touchstart",a=>D(this,a,!0));document.addEventListener("touchend",a=>D(this,a,!1))}}let F=new G;
function H(a){E(a,a.h.length);let b=F.B&&!F.g.B;var c=F.C&&!F.g.C;if(b||c)a.selection<Object.keys(a.g.j).length?(a.active=[a.selection,b?"\u2013":"+"],setTimeout(()=>{a.active=[-1,""]},100),(c=a.h[a.selection])&&void 0!=a.g.m[c]&&(a.g.m[c]=Math.max(0,a.g.m[c]+(b?-1:1)))):a.l=!a.l;F.s&&!F.g.s&&2===a.i&&a.selection==a.h.length&&(a.l?z(C,new I(a.g)):(a.i=0,setTimeout(()=>{z(C,new J(a.g))},1200)))}
class K{constructor(a){this.selection=0;this.active=[-1,""];this.h=[];this.i=2;this.l=!1;this.g=a}L(){this.h=v.filter(a=>{let b=this.g.j[a];this.g.m[a]||(this.g.m[a]=1);return!!b})}H(a=0){L(this.g.v);M("Manage stock",this.g);this.h.length||N(O,"Your stock is empty",12,80,48,"#FFFFFF88","center");let b=0;this.h.forEach(c=>{let d=24*b+24,f=this.g.j[c];f&&(N(O,c,10,1,1+d,"#FFFFFF88"),N(O,`Stock: ${f}`,10,1,d+13,"#FFFFFF88"),["\u2013","+"].map((e,g)=>P(100+53*g,d+5,this.selection===b?"white":"#FFFFFF88",
e,this.active[0]===b&&this.active[1]===e)),N(O,`${this.g.m[c]}$`,10,127,d+7,"#FFFFFF88","center"),b++)});P(130,129,this.l||this.selection!==this.h.length?"#FFFFFF88":"white","next");P(30,129,this.l&&this.selection===this.h.length?"white":"#FFFFFF88","back");2!=this.i&&(this.i=Math.min(1,this.i+a/1E3),R(1-this.i));H(this)}}
let S={apples:{data:"@X@@C@RSERRBWRGx\u007f@",size:6,padding:6,y:0},bread:{data:"hmmEmoomm}}momm}hmmExmmGx\u007f\u007fG@@@@",size:8,padding:9,y:-1},oil:{data:"@mm@@m@@XC@[[[X[[C_[{x\u007f\u007fG",size:7,padding:9,y:-1}};function T(a){E(a,a.g.o.length);if(F.s&&!F.g.s){a.active=a.selection;setTimeout(()=>{a.active=-1},100);let b=a.g.o[a.selection];b&&0<b.j&&b.m<=a.g.u&&(a.g.u-=b.m,a.g.j[b.I]=(a.g.j[b.I]||0)+b.j,b.j=0);a.selection==a.g.o.length&&z(C,new K(a.g))}}
class I{constructor(a){this.selection=0;this.active=-1;this.g=a}L(){this.g.o=this.g.o.filter(a=>0<a.j)}H(){L(this.g.v);M("Suppliers",this.g);this.g.o.forEach((a,b)=>{let c=24*b+24;U(O,S[a.I],3,c+6);N(O,a.N,10,14,1+c,"#FFFFFF88");let d=`${a.j}  ${a.I}   ${a.m}$`;N(O,a.j?d:"soldout",10,14,c+11,"#FFFFFF88");P(140,c+5,this.selection===b?"white":"#FFFFFF88","BUY",this.active===b)});P(130,129,this.selection===this.g.o.length?"white":"#FFFFFF88","next");T(this)}}
class aa{constructor(a){this.total=this.h=this.selection=0;this.i={};this.g=a}R(){this.g.u+=this.total}L(){let a=this.g.history[this.g.v];Object.keys(a.M).map(b=>{var c=a.M[b]=Math.round(a.M[b]||0);a.J[b]=1E4*(a.J[b]||0)/20;this.total+=c*(this.g.m[b]||0);c=Math.max(0,(this.g.j[b]||0)-c);let d=Math.floor((this.g.S[b]||0)*c);this.g.j[b]=c-d;this.i[b]=d})}H(a=0){L(this.g.v);M("Summary",this.g,this.total);P(80,129,"white","next");let b=this.g.history[this.g.v];O.g.save();O.g.rect(0,12,160,112);O.g.clip();
var c=Object.entries(b.M),d=60*Math.max(0,c.length-2);this.selection>d/20&&(this.selection=Math.round(d/20));O.g.translate(0,20*-this.selection);c.map((f,e)=>{e=60*e+15;let g=f[0];f=f[1];U(O,S[g],3,e);var h=Math.round(Math.min(10,10*(b.J[g]||0)));N(O,`${g}`,10,12,e,"#FFFFFF88");N(O,`Demand:  ${"\u25ae".repeat(h)}${"\u25af".repeat(10-h)}`,10,2,e+12,"#FFFFFF88");h=this.g.m[g]||0;N(O,`Sales:  ${f} x ${h}$ = ${f*h}$`,10,2,e+24,"#FFFFFF88");N(O,`Spoiled:  ${this.i[g]}`,10,2,e+36,"#FFFFFF88")});O.g.restore();
1>this.h&&(this.h=Math.min(1,this.h+a/1E3),R(this.h));if(2<c.length){let {width:f,height:e}=P(150,32,"#FFFFFF88","\u25b2");P(150,92,"#FFFFFF88","\u25bc");d=60-e;a=Math.floor(2*d/c.length);c=Math.round((d-a)*this.selection/c.length);O.g.fillStyle="white";O.g.fillRect(150-f/2,32+e+c,f,a)}E(this,99);F.s&&!F.g.s&&(this.g.v++,z(C,new I(this.g)))}}
class J{constructor(a){this.O=[];this.l={};this.i={};this.time=this.h=0;this.g=a;for(a=20;a--;){let b=.5<Math.random()?1:-1;this.O.push({height:Math.round(10*Math.random()-5),step:Math.round(160*Math.random()*b),speed:(.5*Math.random()+.5)*b})}}L(){k=new AudioContext;t=k.currentTime;t=r=0;q=!0;u(!1);v.map(a=>{if(this.g.j[a]){let b=(this.g.P[a]||0)/(this.g.m[a]||1),c=this.g.J[a]||0;this.l[a]=b*c*20/1E4;this.i[a]=0;console.log(b,c)}})}H(a=0){ba();ca();da();ea(this.g.j,this.i);fa(this.g,this.i);ha(this.O);
ia();ja(this.time);1E4>this.time&&(this.time+=a,Object.entries(this.l).forEach(([b,c])=>{let d=this.i[b]||0;d<(this.g.j[b]||0)&&(this.i[b]=d+c*a)}));1E4<this.time?0<this.h?this.h=Math.max(0,this.h-a/1E3):(this.g.save(this.l,this.i),z(C,new aa(this.g))):1>this.h&&(this.h=Math.min(1,this.h+a/1E3));R(this.h)}}function L(a){var b=O;let c=["#4621ac","#322722","#752a1a","#17812e","#1155bb"];b.g.fillStyle=c[a%c.length];b.g.fillRect(0,0,160,144)}
function M(a,b,c=-1){var d=O;d.g.fillStyle="#00000088";d.g.fillRect(0,0,160,12);N(d,`Week ${b.v} - ${a}`,10,1,1,"#c3472c");N(d,`${b.u}$`,10,160,1,"#17812e","right");-1!=c&&N(d,`+ ${c}$`,10,160,13,"#17812e","right")}
function N(a,b,c,d,f,e="white",g="left",h=70){var m=`${c}px sans`;V(a);a.h.font=m;a.h.textBaseline="middle";a.h.textAlign=g;g="center"==g?125:"right"==g?250:0;a.h.fillText(b,g,c/2);b=a.h.getImageData(0,0,250,32);for(c=0;250>c;c++)for(m=0;32>m;m++)if(b.data[4*(250*m+c)+1]>h||b.data[4*(250*m+c)+2]>h||b.data[4*(250*m+c)+3]>h)a.g.fillStyle=e,a.h.fillRect(c,m,1,1),a.g.fillRect(c+d-g,m+f,1,1)}
function P(a,b,c,d,f=!1){var e=O;f=f?1:0;e.g.strokeStyle=c;e.g.fillStyle=c;c=10*d.length;e.g.translate(f,f);e.g.fillRect(a-c/2,b,c,13);N(e,d,10,a,b+2,"#322722","center");e.g.translate(-f,-f);return{width:c,height:13}}
function R(a){var b=O;let c=4;for(;c--;){let d=4;for(;d--;){let f=Math.round(-(Math.cos(Math.PI*a)-1)/2*(160+32*d)),e=36*d;b.g.fillStyle="#c3472c";b.g.fillRect(20*c-f,e,17,36);b.g.fillRect(160-20*(c+1)+f,e,17,36);b.g.fillStyle="#752a1a";b.g.fillRect(160-20*(c+1)+17+f,e,3,36);b.g.fillRect(20*c-f+17,e,3,36)}}}
function U(a,b,c,d){let f=[];[...b.data].map(e=>{e=e.charCodeAt(0);f.push(e&7);f.push(e>>3&7)});for(let e=0;e<b.size;e++)for(let g=0;g<b.size;g++)if(f[e*b.size+g]){let h=3*(f[e*b.size+g]-1);a.g.fillStyle="#"+"000c422c415bea0ddd642".substring(h,h+3);a.g.fillRect(c+g,d+e,1,1)}}
function ba(){var a=O;for(let f=0;10>=f;f++)for(let e=0;6>=e;e++){var b=a,c=26*e-(f%2?18:5),d=16*f-5;b.g.fillStyle="#322722";b.g.fillRect(c,d,26,16);b.g.fillStyle="#7d736e";b.g.fillRect(c+1,d+1,25,15)}a.g.fillStyle="#40312a";a.g.fillRect(0,90,160,54)}
function ca(){var a=O;a.g.fillStyle=W(a,30,0,38,0);a.g.fillRect(30,23,8,85);a.g.fillStyle=W(a,122,0,130,0);a.g.fillRect(122,23,8,85);a.g.fillStyle=W(a,0,23,0,27);a.g.fillRect(18,23,124,4);for(let b=0;7>b;b++)a.g.beginPath(),a.g.fillStyle=b%2?"#b77e62":"#752a1a",X(a,32+16*b,32,8),a.g.fill(),a.g.beginPath(),a.g.fillStyle=b%2?"#f7cebd":"#c3472c",X(a,32+16*b,30,8),a.g.rect(24+16*b,22,16,8),a.g.fill()}
function da(){var a=O;for(let b=0;3>b;b++)a.g.fillStyle="#6d412e",a.g.fillRect(35+30*b,76,30,36),a.g.fillStyle="#b77e62",a.g.fillRect(30*b+36,100,28,3),a.g.fillRect(30*b+36,104,28,3),a.g.fillRect(30*b+36,108,28,3),a.g.fillStyle="#322722",a.g.fillRect(30*b+36,77,28,22)}
function ea(a,b){var c=O;let d=Object.entries(a).filter(([,f])=>!!f);d.forEach(([f,e],g)=>{let h=S[f],m=Math.floor(27/h.padding);g=3===d.length?g:1===d.length?1:2*g;f=Math.min(Math.floor(e-b[f]),m*Math.ceil(25/h.padding));for(e=0;e<f;e++)U(c,h,37+e%m*h.padding+30*g+(7>h.padding?Math.floor(e/m)%2*h.padding/2:0),73+Math.floor(e/m)*(h.padding-1)-h.y)})}
function fa(a,b){var c=O;b=Object.entries(b).reduce((d,[f,e])=>d+(a.m[f]||0)*Math.floor(e),0);c.g.fillStyle="#f7cebd";c.g.fillRect(3,3,50,12);c.g.fillRect(107,3,50,12);N(c,`Week ${a.v}`,10,5,5,"#322722");N(c,`${a.u+b}$`,10,155,5,"#322722","right")}
function ha(a){var b=O;b.g.beginPath();b.g.fillStyle="#00000055";a.forEach(c=>{let d=120+c.height+Math.round(Math.sin(c.step/2)),f=Math.round(c.step);X(b,f+17,d,10,.7);X(b,f,d+20,15,.7);c.step+=c.speed;-40>c.step?c.step=200:200<c.step&&(c.step=-40)});b.g.fill()}function ia(){var a=O;let b=performance.now()-a.time;a.time=performance.now();a.i=.99*a.i+1E3/b*.01;a.g.fillText(`${Math.round(a.i)}FPS`,10,134)}
function ja(a){var b=O;b.g.beginPath();b.g.fillStyle="#f7cebd";X(b,80,8,7);b.g.fill();a=2*Math.PI*a/1E4-Math.PI/2;ka(b,80+6*Math.cos(a),8+6*Math.sin(a))}function V(a){a.h.clearRect(0,0,a.h.canvas.width,a.h.canvas.height)}function ka(a,b,c){let d=80,f=8;b=Math.round(b);c=Math.round(c);b-=80;c-=8;let e=Math.max(Math.abs(b),Math.abs(c));b/=e;c/=e;let g=[];for(a.g.fillStyle="#322722";e--;)g.push([d,f]),d+=b,f+=c;a.g.beginPath();g.map(([h,m])=>{a.g.rect(Math.round(h),Math.round(m),1,1)});a.g.fill()}
function X(a,b,c,d,f=0){let e=d,g=0,h=0;for(a.g.rect(b-e,c,d<<1,1);e>g;)h-=--e-++g,0>h&&(h+=e++),d=Math.round(f*e),a.g.rect(b-g+d,c-e,g<<1,1),a.g.rect(b-g-d,c+e,g<<1,1),d=Math.round(f*g),a.g.rect(b-e+d,c-g,e<<1,1),a.g.rect(b-e-d,c+g,e<<1,1)}function W(a,b,c,d,f){var e=[[.25,"#6d412e"],[.75,"#b77e62"],[1,"#6d412e"]];let g=a.g.createLinearGradient(b,c,d,f);e.forEach(([h,m],Q)=>{0!=Q&&g.addColorStop(e[Q-1][0],m);g.addColorStop(h,m)});return g}
class la{constructor(){this.i=60;this.time=0;this.g=c2d.getContext("2d");this.h=font.getContext("2d");this.g.canvas.height=144;this.g.canvas.width=160}}let O=new la;class ma{constructor(a){this.g=new y;if(!a){a=this.g;let e=localStorage.getItem("history");if(e){var {history:b,o:c,u:d,j:f}=JSON.parse(e);a.history=b;a.o=c;a.u=d;a.j=f;a.v=b.length}}C=new A(new I(this.g),...[])}H(a){C.g.H(a)}}
function na(a){["\ud835\udd44\ud835\udd52\ud835\udd63\ud835\udd5c\ud835\udd56\ud835\udd65","\ud835\udd4a\ud835\udd65\ud835\udd63\ud835\udd56\ud835\udd56\ud835\udd65","\ud835\udd4b\ud835\udd6a\ud835\udd54\ud835\udd60\ud835\udd60\ud835\udd5f"].map((b,c)=>{N(O,b,20,80,8+16*c,"#c3472c","center",100)});["New Game","Continue","FullScreen","Help","About"].map((b,c)=>{N(O,`${a.selection==c?"\u25b8":" "} ${b}`,10,10,70+13*c,a.selection==c?"white":"#FFFFFF88")})}
function Y(a,b=9){a.map((c,d)=>{N(O,c,b,10,12+12*d,"#f7cebd","left",100)});P(80,129,"#ffeae0","return")}
class oa{constructor(){this.selection=0;this.h=this.g=!1}H(){L(1);this.h?Y("Game made by lopis;for js13k 2023;;github.com/lopis;js13kgames.com;;\u2665".split(";"),13):this.g?Y("You're a merchant in the; village market, trying to; succed. Buy goods from the; region and resell them for; the best price, depending; on customer demand.;;Use the arrow keys and Enter; to control the game.".split(";")):na(this);E(this,4);F.s&&!F.g.s&&(this.h||this.g?this.g=this.h=!1:1>=this.selection?z(B,new ma(0===this.selection)):
2==this.selection?document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen():3==this.selection?this.g=!0:this.h=!0)}}let pa=new oa;document.querySelector('link[type="image/x-icon"]').href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E\ud83c\udf4e%3C/text%3E%3C/svg%3E";B=new A(pa,...[]);let Z=0,qa=1E3/60;
(function ra(a){let c=a-Z;if(c>=qa){Z=a;a=F;a.g.D=a.D;a.g.A=a.A;a.g.B=a.B;a.g.C=a.C;a.g.s=a.s;a.g.K=a.K;let d=navigator.getGamepads&&navigator.getGamepads()[0],f=a.h.get("KeyA")||a.h.get("ArrowLeft")||"left"===a.l||d?.buttons[14].pressed?-1:0,e=a.h.get("KeyD")||a.h.get("ArrowRight")||"right"===a.l||d?.buttons[15].pressed?1:0,g=a.h.get("KeyW")||a.h.get("ArrowUp")||"up"===a.l||d?.buttons[12].pressed?-1:0,h=a.h.get("KeyS")||a.h.get("ArrowDown")||"down"===a.l||d?.buttons[13].pressed?1:0;a.i.x=f+e||d?.axes[0]||
0;a.i.y=g+h||d?.axes[1]||0;.1>Math.hypot(a.i.x,a.i.y)&&(a.i.x=0,a.i.y=0);a.D=0>a.i.y;a.A=0<a.i.y;a.B=0>a.i.x;a.C=0<a.i.x;a.s=!!(a.h.get("Enter")||"ok"===a.l||d?.buttons[0].pressed||d?.buttons[9].pressed);a.K=!(!a.h.get("Escape")&&!d?.buttons[8].pressed);a=O;V(a);a.g.clearRect(0,0,160,144);B.g.H(c)}requestAnimationFrame(ra)})(0);